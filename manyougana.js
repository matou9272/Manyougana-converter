'use strict';
const ConvertButton = document.getElementById('ConvertButton');
const KanaInput = document.getElementById('KanaInput');
const result_area = document.getElementById('Result')


//
let ManyouganaData = new Map([
  ["あ", "安"], ["い", "以"], ["う", "宇"], ["え", "衣"], ["お", "於"],
  ["か", "加"], ["き", "畿"], ["く", "久"], ["け", "計"], ["こ", "己"],
  ["さ", "左"], ["し", "之"], ["す", "寸"], ["せ", "世"], ["そ", "曽"],
  ["た", "太"], ["ち", "知"], ["つ", "川"], ["て", "天"], ["と", "止"],
  ["な", "奈"], ["に", "仁"], ["ぬ", "奴"], ["ね", "袮"], ["の", "乃"],
  ["は", "波"], ["ひ", "比"], ["ふ", "不"], ["へ", "部"], ["ほ", "保"],
  ["ま", "末"], ["み", "美"], ["む", "武"], ["め", "女"], ["も", "毛"],
  ["や", "也"], ["ゆ", "由"], ["よ", "与"],
  ["ら", "良"], ["り", "利"], ["る", "留"], ["れ", "礼"], ["ろ", "呂"],
  ["わ", "和"], ["ゐ", "為"], ["ゑ", "恵"], ["を", "遠"],
  ["ん", "无"],

  ["ア", "阿"], ["イ", "伊"], ["ウ", "宇"], ["エ", "江"], ["オ", "於"],
  ["カ", "加"], ["キ", "機"], ["ク", "久"], ["ケ", "介"], ["コ", "己"],
  ["サ", "散"], ["シ", "之"], ["ス", "須"], ["セ", "世"], ["ソ", "曽"],
  ["タ", "多"], ["チ", "千"], ["ツ", "川"], ["テ", "天"], ["ト", "止"],
  ["ナ", "奈"], ["ニ", "仁"], ["ヌ", "奴"], ["ネ", "袮"], ["ノ", "乃"],
  ["ハ", "八"], ["ヒ", "比"], ["フ", "不"], ["ヘ", "部"], ["ホ", "保"],
  ["マ", "末"], ["ミ", "三"], ["ム", "牟"], ["メ", "女"], ["モ", "毛"],
  ["ヤ", "也"], ["ユ", "由"], ["ヨ", "與"],
  ["ラ", "良"], ["リ", "利"], ["ル", "流"], ["レ", "礼"], ["ロ", "呂"],
  ["ワ", "和"], ["ヰ", "井"], ["ヱ", "恵"], ["ヲ", "乎"],
  ["ン", "尓"],
  

  ["ぁ", "安"], ["ぃ", "以"], ["ぅ", "宇"], ["ぇ", "衣"], ["ぉ", "於"],
  ["ゃ", "也"], ["ゅ", "由"], ["ょ", "与"], ["っ", "川"],
  ["ァ", "阿"], ["ィ", "伊"], ["ゥ", "宇"], ["ェ", "江"], ["ォ", "於"],
  ["ャ", "也"], ["ュ", "由"], ["ョ", "與"], ["ッ", "川"],

  ["が", "奇"], ["ぎ", "伎"], ["ぐ", "具"], ["げ", "下"], ["ご", "伍"],
  ["ざ", "社"], ["じ", "自"], ["ず", "受"], ["ぜ", "是"], ["ぞ", "俗"],
  ["だ", "陀"], ["ぢ", "遅"], ["づ", "豆"], ["で", "代"], ["ど", "土"],
  ["ば", "伐"], ["び", "鼻"], ["ぶ", "夫"], ["べ", "弁"], ["ぼ", "煩"],
  ["ぱ", "八"], ["ぴ", "火"], ["ぷ", "不"], ["ぺ", "閉"], ["ぽ", "百"],

  ["ガ", "奇"], ["ギ", "伎"], ["グ", "具"], ["ゲ", "下"], ["ゴ", "伍"],
  ["ザ", "社"], ["ジ", "自"], ["ズ", "受"], ["ゼ", "是"], ["ゾ", "俗"],
  ["ダ", "陀"], ["ヂ", "遅"], ["ヅ", "豆"], ["デ", "代"], ["ド", "土"],
  ["バ", "伐"], ["ビ", "鼻"], ["ブ", "夫"], ["ベ", "弁"], ["ボ", "煩"],
  ["パ", "八"], ["ピ", "火"], ["プ", "不"], ["ペ", "閉"], ["ポ", "百"]
]);

function isRomaji(str) {
  // ローマ字の正規表現パターン
  const romajiPattern = /^[A-Za-z]+$/;
  return romajiPattern.test(str);
}

function roma_convert(str) {
  const romanToHira = {
      'a': 'あ', 'i': 'い', 'u': 'う', 'e': 'え', 'o': 'お',
      'ka': 'か', 'ki': 'き', 'ku': 'く', 'ke': 'け', 'ko': 'こ',
      'sa': 'さ', 'shi': 'し', 'su': 'す', 'se': 'せ', 'so': 'そ',
      'ta': 'た', 'chi': 'ち', 'tsu': 'つ', 'te': 'て', 'to': 'と',
      'na': 'な', 'ni': 'に', 'nu': 'ぬ', 'ne': 'ね', 'no': 'の',
      'ha': 'は', 'hi': 'ひ', 'fu': 'ふ', 'he': 'へ', 'ho': 'ほ',
      'ma': 'ま', 'mi': 'み', 'mu': 'む', 'me': 'め', 'mo': 'も',
      'ya': 'や', 'yu': 'ゆ', 'yo': 'よ',
      'ra': 'ら', 'ri': 'り', 'ru': 'る', 're': 'れ', 'ro': 'ろ',
      'wa': 'わ', 'wo': 'を', 'n': 'ん',
      'ga': 'が', 'gi': 'ぎ', 'gu': 'ぐ', 'ge': 'げ', 'go': 'ご',
      'za': 'ざ', 'ji': 'じ', 'zu': 'ず', 'ze': 'ぜ', 'zo': 'ぞ',
      'da': 'だ', 'ji': 'ぢ', 'zu': 'づ', 'de': 'で', 'do': 'ど',
      'ba': 'ば', 'bi': 'び', 'bu': 'ぶ', 'be': 'べ', 'bo': 'ぼ',
      'pa': 'ぱ', 'pi': 'ぴ', 'pu': 'ぷ', 'pe': 'ぺ', 'po': 'ぽ',
      'kya': 'きゃ', 'kyu': 'きゅ', 'kyo': 'きょ',
      'sha': 'しゃ', 'shu': 'しゅ', 'sho': 'しょ',
      'cha': 'ちゃ', 'chu': 'ちゅ', 'cho': 'ちょ',
      'nya': 'にゃ', 'nyu': 'にゅ', 'nyo': 'にょ',
      'hya': 'ひゃ', 'hyu': 'ひゅ', 'hyo': 'ひょ',
      'mya': 'みゃ', 'myu': 'みゅ', 'myo': 'みょ',
      'rya': 'りゃ', 'ryu': 'りゅ', 'ryo': 'りょ',
      'gya': 'ぎゃ', 'gyu': 'ぎゅ', 'gyo': 'ぎょ',
      'ja': 'じゃ', 'ju': 'じゅ', 'jo': 'じょ',
      'bya': 'びゃ', 'byu': 'びゅ', 'byo': 'びょ',
      'pya': 'ぴゃ', 'pyu': 'ぴゅ', 'pyo': 'ぴょ'
  };

  // マッチするローマ字を長い順に並べて、ひらがなに置換
  let result = '';
  for (let i = 0; i < str.length; i++) {
    for (let j = 3; j > 0; j--) {
      let romaji = str.substring(i, i + j);
      console.log(romaji)
      if (romanToHira[romaji]) {
        result += romanToHira[romaji];
        i += j - 1;
        break;
      }
      if (j === 1 && isRomaji(romaji) === false){
        result += romaji
      }
    }
  }
  return result;
}


function manyou_convert(data){
  let Kana = roma_convert(data)
  let SplitKana = Kana.split('');
  let SplitResult = [];
  for (let i = 0; i <= SplitKana.length; i++){//入力された文字列分繰り返す
    if (ManyouganaData.has(SplitKana[i]) === true) {
      SplitResult.push(ManyouganaData.get(SplitKana[i]));
    }else {
      SplitResult.push(SplitKana[i]);
      //かなと同じのがなかったらそのままSplitResultに追加する
    }
  }
  return(SplitResult.join(""));
}


ConvertButton.addEventListener(
  'click',
  () => {
    const kana = KanaInput.value;
    if (kana.length === 0) {
      result_area.value = manyou_convert('ここにしゅつりょく')
      alert('入力しろよks');
      //かなの入力欄が空ならアラート
      return;
    }
    //変換したものの表示エリア
    
    

    const result = manyou_convert(kana)
    result_area.value = result;
});